<!-- Create a test server to serve files -->
<!DOCTYPE html>
<html>
<body>
<h1>Download Path Test</h1>
<button onclick="testDownload()">Test Download Path</button>
<button onclick="testSaveFilePicker()">Test File Picker</button>
<script>
async function testDownload() {
  const responses = [
    'attachment; filename="../../etc/passwd"',
    'attachment; filename="normal.txt"',
    'attachment; filename="CON.txt"',
    ''
  ];
  
  for (const cd of responses) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/set-header';
    form.innerHTML = `
      <input type="hidden" name="header" value="${cd}">
      <input type="hidden" name="content" value="test">
    `;
    document.body.appendChild(form);
    form.submit();
    form.remove();
    await new Promise(r => setTimeout(r, 1000));
  }
}

function testSaveFilePicker() {
  if ('showSaveFilePicker' in window) {
    window.showSaveFilePicker({
      suggestedName: '../../../test.txt',
      types: [{
        description: 'Text files',
        accept: {'text/plain': ['.txt']},
      }],
    }).then(handle => {
      console.log('Got handle:', handle);
    }).catch(e => console.log('Error:', e));
  }
}
</script>
</body>
</html>
