<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlowAI Pro - Real-Time Makeup Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f0b1e;
            color: #f0e6ff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #1a0f3d 0%, #2d1b69 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(157, 123, 255, 0.2);
            border: 1px solid #3a2a7a;
        }
        
        .logo {
            font-size: 2.8rem;
            color: #ff66b2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 {
            color: #c2b5ff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff66b2, #9d7bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #b8a9ff;
            max-width: 800px;
            margin: 0 auto 20px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .face-scan-section {
            background-color: #1a0f3d;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid #3a2a7a;
            display: flex;
            flex-direction: column;
        }
        
        .results-section {
            background-color: #1a0f3d;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid #3a2a7a;
            overflow-y: auto;
            max-height: 900px;
        }
        
        .section-title {
            color: #c2b5ff;
            font-size: 1.6rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a2a7a;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: #ff66b2;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 400px;
            background-color: #0f0b1e;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            border: 2px solid #3a2a7a;
        }
        
        #inputVideo, #outputCanvas {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }
        
        #outputCanvas {
            z-index: 10;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 15, 61, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            border-radius: 15px;
        }
        
        .camera-placeholder {
            text-align: center;
            color: #b8a9ff;
            padding: 20px;
        }
        
        .camera-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #9d7bff;
        }
        
        .control-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            flex: 1;
            padding: 16px;
            background: linear-gradient(to right, #ff66b2, #9d7bff);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(157, 123, 255, 0.4);
        }
        
        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .control-btn.secondary {
            background: linear-gradient(to right, #3a2a7a, #5d46cc);
        }
        
        .tracking-status {
            background-color: #0f0b1e;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #3a2a7a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ff4757;
        }
        
        .status-indicator.active {
            background-color: #2ed573;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .analysis-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .result-card {
            background-color: #0f0b1e;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #3a2a7a;
        }
        
        .result-title {
            font-size: 0.9rem;
            color: #b8a9ff;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffd6e7;
        }
        
        .skin-tone-preview {
            height: 25px;
            width: 100%;
            border-radius: 5px;
            margin-top: 8px;
            border: 1px solid #3a2a7a;
        }
        
        .instructions-container {
            background-color: #0f0b1e;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #3a2a7a;
        }
        
        .instruction-step {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #3a2a7a;
        }
        
        .instruction-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .step-number {
            background: linear-gradient(to right, #ff66b2, #9d7bff);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content h4 {
            color: #c2b5ff;
            margin-bottom: 5px;
        }
        
        .step-content p {
            color: #b8a9ff;
            font-size: 0.95rem;
        }
        
        .makeup-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .makeup-option {
            flex: 1;
            min-width: 120px;
            background-color: #0f0b1e;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .makeup-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(157, 123, 255, 0.2);
            border-color: #9d7bff;
        }
        
        .makeup-option.active {
            border-color: #9d7bff;
            background-color: #1a0f3d;
            box-shadow: 0 5px 15px rgba(157, 123, 255, 0.3);
        }
        
        .makeup-icon {
            font-size: 2rem;
            color: #ff66b2;
            margin-bottom: 10px;
        }
        
        .makeup-name {
            font-weight: 600;
            color: #c2b5ff;
        }
        
        .eyebrow-samples {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
            gap: 10px;
        }
        
        .eyebrow-sample {
            width: 80px;
            height: 20px;
            background-color: #5a3d8a;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #7b5fbb;
        }
        
        .eyebrow-sample:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(157, 123, 255, 0.5);
        }
        
        .eyebrow-sample.selected {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(157, 123, 255, 0.8);
            border-color: #ff66b2;
        }
        
        .makeup-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .slider-container {
            flex: 1;
            min-width: 200px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #b8a9ff;
            font-size: 0.9rem;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #0f0b1e;
            outline: none;
            -webkit-appearance: none;
            border: 1px solid #3a2a7a;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #9d7bff;
            cursor: pointer;
            border: 2px solid #c2b5ff;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7b6b93;
            font-size: 0.9rem;
            border-top: 1px solid #3a2a7a;
            margin-top: 30px;
        }
        
        .feature-point {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #ff66b2;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            z-index: 20;
            pointer-events: none;
        }
        
        .face-landmark {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: rgba(255, 102, 178, 0.5);
            z-index: 15;
            pointer-events: none;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            color: #b8a9ff;
        }
        
        .loading i {
            margin-right: 10px;
            color: #ff66b2;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-sparkles"></i> 
                <span>GlowAI Pro</span>
                <i class="fas fa-sparkles"></i>
            </div>
            <h1>Real-Time AI Makeup Assistant</h1>
            <p class="tagline">Advanced face tracking keeps your virtual makeup perfectly aligned as you move. Try different looks in real-time with our AI-powered tracking technology.</p>
        </header>
        
        <div class="main-content">
            <section class="face-scan-section">
                <h2 class="section-title"><i class="fas fa-video"></i> Live Face Tracking</h2>
                
                <div class="camera-container">
                    <video id="inputVideo" autoplay playsinline></video>
                    <canvas id="outputCanvas"></canvas>
                    
                    <div class="camera-overlay" id="cameraOverlay">
                        <div class="camera-placeholder">
                            <i class="fas fa-camera"></i>
                            <p>Click "Start Camera" to begin face tracking</p>
                            <p>Make sure your face is well-lit and visible</p>
                        </div>
                    </div>
                    
                    <!-- Face landmarks will be drawn here -->
                </div>
                
                <div class="tracking-status">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <div id="statusText">Camera not active. Click "Start Camera" to begin.</div>
                </div>
                
                <div class="control-buttons">
                    <button class="control-btn" id="startButton">
                        <i class="fas fa-play-circle"></i> Start Camera
                    </button>
                    <button class="control-btn secondary" id="stopButton" disabled>
                        <i class="fas fa-stop-circle"></i> Stop Camera
                    </button>
                    <button class="control-btn secondary" id="captureButton" disabled>
                        <i class="fas fa-camera-retro"></i> Capture Look
                    </button>
                </div>
                
                <div class="makeup-controls">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Makeup Intensity</span>
                            <span id="intensityValue">50%</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="slider" id="intensitySlider">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Lipstick Opacity</span>
                            <span id="lipOpacityValue">70%</span>
                        </div>
                        <input type="range" min="0" max="100" value="70" class="slider" id="lipOpacitySlider">
                    </div>
                </div>
                
                <p style="margin-top: 15px; color: #b8a9ff; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> The face tracking will keep makeup in place as you move. Try turning your head slowly to see the tracking in action.
                </p>
            </section>
            
            <section class="results-section">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> Real-Time Analysis</h2>
                
                <div class="analysis-results">
                    <div class="result-card">
                        <div class="result-title">Face Tracking</div>
                        <div class="result-value" id="trackingStatusValue">Inactive</div>
                        <div class="result-title" style="margin-top: 8px;">Landmarks Detected</div>
                        <div class="result-value" id="landmarksCount">0</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-title">Skin Tone Analysis</div>
                        <div class="result-value" id="skinToneValue">Analyzing...</div>
                        <div class="skin-tone-preview" id="skinTonePreview" style="background-color: #3a2a7a;"></div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-title">Face Shape</div>
                        <div class="result-value" id="faceShapeValue">-</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-title">Makeup Intensity</div>
                        <div class="result-value" id="makeupIntensityValue">50%</div>
                    </div>
                </div>
                
                <h3 class="section-title"><i class="fas fa-palette"></i> Makeup Looks</h3>
                
                <div class="makeup-options">
                    <div class="makeup-option active" data-look="natural" id="lookNatural">
                        <div class="makeup-icon"><i class="fas fa-leaf"></i></div>
                        <div class="makeup-name">Natural Day</div>
                    </div>
                    
                    <div class="makeup-option" data-look="glam" id="lookGlam">
                        <div class="makeup-icon"><i class="fas fa-gem"></i></div>
                        <div class="makeup-name">Evening Glam</div>
                    </div>
                    
                    <div class="makeup-option" data-look="bold" id="lookBold">
                        <div class="makeup-icon"><i class="fas fa-fire"></i></div>
                        <div class="makeup-name">Bold & Bright</div>
                    </div>
                    
                    <div class="makeup-option" data-look="soft" id="lookSoft">
                        <div class="makeup-icon"><i class="fas fa-cloud"></i></div>
                        <div class="makeup-name">Soft Romantic</div>
                    </div>
                </div>
                
                <h3 class="section-title" style="margin-top: 25px;"><i class="fas fa-eye"></i> Eyebrow Styles</h3>
                <p style="color: #b8a9ff; margin-bottom: 10px;">Select an eyebrow shape to apply:</p>
                
                <div class="eyebrow-samples">
                    <div class="eyebrow-sample" style="width: 70px; height: 18px;" data-brow="soft-arch" id="browSoftArch"></div>
                    <div class="eyebrow-sample" style="width: 85px; height: 22px; border-radius: 0 0 10px 10px;" data-brow="straight" id="browStraight"></div>
                    <div class="eyebrow-sample" style="width: 65px; height: 20px; border-radius: 15px 15px 0 0;" data-brow="rounded" id="browRounded"></div>
                    <div class="eyebrow-sample" style="width: 75px; height: 16px;" data-brow="s-shaped" id="browSShaped"></div>
                </div>
                
                <div class="instructions-container">
                    <h3><i class="fas fa-info-circle"></i> Application Instructions</h3>
                    <div id="instructionsContent">
                        <div class="instruction-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Start Camera Tracking</h4>
                                <p>Click "Start Camera" to begin face detection. Ensure your face is well-lit and clearly visible to the camera.</p>
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Select Makeup Look</h4>
                                <p>Choose from Natural Day, Evening Glam, Bold & Bright, or Soft Romantic makeup styles.</p>
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Try Eyebrow Shapes</h4>
                                <p>Click on different eyebrow styles to see how they would look on your face shape.</p>
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Adjust Intensity</h4>
                                <p>Use the sliders to adjust makeup intensity and lipstick opacity to your preference.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>GlowAI Pro &copy; 2023 | Real-time face tracking powered by MediaPipe Face Mesh. Works best in Chrome with good lighting.</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">
                <i class="fas fa-shield-alt"></i> Your camera data is processed locally and never leaves your device.
            </p>
        </footer>
    </div>

    <script>
        // Global variables
        let faceMesh = null;
        let camera = null;
        let isCameraActive = false;
        let currentMakeupLook = 'natural';
        let currentEyebrowStyle = 'soft-arch';
        let makeupIntensity = 0.5;
        let lipOpacity = 0.7;
        let faceDetected = false;
        let lastFaceLandmarks = null;
        
        // DOM Elements
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const captureButton = document.getElementById('captureButton');
        const inputVideo = document.getElementById('inputVideo');
        const outputCanvas = document.getElementById('outputCanvas');
        const outputCtx = outputCanvas.getContext('2d');
        const cameraOverlay = document.getElementById('cameraOverlay');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const trackingStatusValue = document.getElementById('trackingStatusValue');
        const landmarksCount = document.getElementById('landmarksCount');
        const skinToneValue = document.getElementById('skinToneValue');
        const skinTonePreview = document.getElementById('skinTonePreview');
        const faceShapeValue = document.getElementById('faceShapeValue');
        const makeupIntensityValue = document.getElementById('makeupIntensityValue');
        const intensitySlider = document.getElementById('intensitySlider');
        const intensityValue = document.getElementById('intensityValue');
        const lipOpacitySlider = document.getElementById('lipOpacitySlider');
        const lipOpacityValue = document.getElementById('lipOpacityValue');
        
        // Makeup look elements
        const makeupOptions = document.querySelectorAll('.makeup-option');
        const eyebrowSamples = document.querySelectorAll('.eyebrow-sample');
        
        // Initialize MediaPipe Face Mesh
        async function initializeFaceMesh() {
            try {
                faceMesh = new FaceMesh({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
                    }
                });
                
                faceMesh.setOptions({
                    maxNumFaces: 1,
                    refineLandmarks: true,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                faceMesh.onResults(onFaceMeshResults);
                
                console.log("MediaPipe Face Mesh initialized");
                return true;
            } catch (error) {
                console.error("Error initializing Face Mesh:", error);
                statusText.textContent = "Error: Could not initialize face tracking";
                return false;
            }
        }
        
        // Start camera and face tracking
        async function startCamera() {
            try {
                // Initialize Face Mesh if not already done
                if (!faceMesh) {
                    const initialized = await initializeFaceMesh();
                    if (!initialized) return;
                }
                
                // Get user media (camera)
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: "user"
                    },
                    audio: false
                });
                
                inputVideo.srcObject = stream;
                isCameraActive = true;
                
                // Set canvas dimensions to match video
                inputVideo.addEventListener('loadedmetadata', () => {
                    outputCanvas.width = inputVideo.videoWidth;
                    outputCanvas.height = inputVideo.videoHeight;
                    
                    // Start processing frames
                    camera = new Camera(inputVideo, {
                        onFrame: async () => {
                            if (isCameraActive && faceMesh) {
                                await faceMesh.send({image: inputVideo});
                            }
                        },
                        width: inputVideo.videoWidth,
                        height: inputVideo.videoHeight
                    });
                    
                    camera.start();
                    
                    // Update UI
                    cameraOverlay.style.display = 'none';
                    statusIndicator.classList.add('active');
                    statusText.textContent = 'Face tracking active - Move your face to test tracking';
                    trackingStatusValue.textContent = 'Active';
                    trackingStatusValue.style.color = '#2ed573';
                    
                    startButton.disabled = true;
                    stopButton.disabled = false;
                    captureButton.disabled = false;
                });
                
            } catch (error) {
                console.error("Error accessing camera:", error);
                statusText.textContent = "Error: Could not access camera. Please check permissions.";
                
                // Fallback: Use demo mode without camera
                cameraOverlay.innerHTML = `
                    <div class="camera-placeholder">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Camera access denied or not available</p>
                        <p>Running in demo mode with simulated face tracking</p>
                        <button class="control-btn" style="margin-top: 15px;" id="demoModeBtn">Enable Demo Mode</button>
                    </div>
                `;
                
                document.getElementById('demoModeBtn')?.addEventListener('click', enableDemoMode);
            }
        }
        
        // Demo mode for when camera is not available
        function enableDemoMode() {
            isCameraActive = true;
            cameraOverlay.style.display = 'none';
            statusIndicator.classList.add('active');
            statusText.textContent = 'Demo mode active - Simulating face tracking';
            trackingStatusValue.textContent = 'Demo Mode';
            
            // Set canvas dimensions
            outputCanvas.width = 640;
            outputCanvas.height = 480;
            
            // Draw a simulated face
            drawSimulatedFace();
            
            // Simulate face detection
            simulateFaceTracking();
            
            startButton.disabled = true;
            stopButton.disabled = false;
            captureButton.disabled = false;
        }
        
        // Draw a simulated face on canvas
        function drawSimulatedFace() {
            outputCtx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);
            
            // Draw face outline
            const centerX = outputCanvas.width / 2;
            const centerY = outputCanvas.height / 2;
            const faceWidth = 200;
            const faceHeight = 280;
            
            // Face
            outputCtx.beginPath();
            outputCtx.ellipse(centerX, centerY, faceWidth/2, faceHeight/2, 0, 0, Math.PI * 2);
            outputCtx.strokeStyle = '#ff66b2';
            outputCtx.lineWidth = 2;
            outputCtx.stroke();
            
            // Eyes
            outputCtx.beginPath();
            outputCtx.ellipse(centerX - 50, centerY - 30, 15, 10, 0, 0, Math.PI * 2);
            outputCtx.ellipse(centerX + 50, centerY - 30, 15, 10, 0, 0, Math.PI * 2);
            outputCtx.strokeStyle = '#9d7bff';
            outputCtx.stroke();
            
            // Nose
            outputCtx.beginPath();
            outputCtx.moveTo(centerX, centerY);
            outputCtx.lineTo(centerX - 10, centerY + 40);
            outputCtx.lineTo(centerX + 10, centerY + 40);
            outputCtx.closePath();
            outputCtx.strokeStyle = '#9d7bff';
            outputCtx.stroke();
            
            // Lips
            outputCtx.beginPath();
            outputCtx.ellipse(centerX, centerY + 70, 30, 15, 0, 0, Math.PI);
            outputCtx.strokeStyle = '#ff66b2';
            outputCtx.stroke();
            
            // Add some "landmark" points
            for (let i = 0; i < 20; i++) {
                const angle = (i / 20) * Math.PI * 2;
                const x = centerX + Math.cos(angle) * faceWidth/2;
                const y = centerY + Math.sin(angle) * faceHeight/2;
                
                outputCtx.beginPath();
                outputCtx.arc(x, y, 3, 0, Math.PI * 2);
                outputCtx.fillStyle = 'rgba(255, 102, 178, 0.7)';
                outputCtx.fill();
            }
            
            // Update landmarks count
            landmarksCount.textContent = '20 (simulated)';
            
            // Apply virtual makeup
            applyVirtualMakeup();
        }
        
        // Simulate face tracking in demo mode
        function simulateFaceTracking() {
            // Update face shape analysis
            const faceShapes = ["Oval", "Round", "Square", "Heart", "Diamond"];
            const randomFaceShape = faceShapes[Math.floor(Math.random() * faceShapes.length)];
            faceShapeValue.textContent = randomFaceShape;
            
            // Update skin tone analysis
            const skinTones = [
                {name: "Fair Ivory", color: "#f5e1d2"},
                {name: "Light Beige", color: "#e8c8af"},
                {name: "Medium Warm", color: "#d8b08c"},
                {name: "Olive Tone", color: "#c19a6b"},
                {name: "Deep Mahogany", color: "#8d5524"}
            ];
            const randomSkinTone = skinTones[Math.floor(Math.random() * skinTones.length)];
            skinToneValue.textContent = randomSkinTone.name;
            skinTonePreview.style.backgroundColor = randomSkinTone.color;
            
            // Mark as face detected
            faceDetected = true;
        }
        
        // Stop camera and tracking
        function stopCamera() {
            if (camera) {
                camera.stop();
            }
            
            if (inputVideo.srcObject) {
                const tracks = inputVideo.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                inputVideo.srcObject = null;
            }
            
            isCameraActive = false;
            faceDetected = false;
            
            // Clear canvas
            outputCtx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);
            
            // Update UI
            cameraOverlay.style.display = 'flex';
            statusIndicator.classList.remove('active');
            statusText.textContent = 'Camera stopped';
            trackingStatusValue.textContent = 'Inactive';
            trackingStatusValue.style.color = '#ff4757';
            landmarksCount.textContent = '0';
            
            startButton.disabled = false;
            stopButton.disabled = true;
            captureButton.disabled = true;
            
            // Reset analysis
            skinToneValue.textContent = 'Analyzing...';
            skinTonePreview.style.backgroundColor = '#3a2a7a';
            faceShapeValue.textContent = '-';
        }
        
        // Capture current look (screenshot)
        function captureLook() {
            if (!faceDetected) {
                alert("Please start camera and wait for face detection before capturing.");
                return;
            }
            
            // Create a temporary canvas to draw the final image
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = outputCanvas.width;
            tempCanvas.height = outputCanvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw the current output canvas
            tempCtx.drawImage(outputCanvas, 0, 0);
            
            // Add some text overlay
            tempCtx.fillStyle = 'rgba(26, 15, 61, 0.8)';
            tempCtx.fillRect(10, tempCanvas.height - 80, tempCanvas.width - 20, 70);
            
            tempCtx.font = '16px Segoe UI';
            tempCtx.fillStyle = '#ffd6e7';
            tempCtx.fillText(`GlowAI Makeup Look: ${currentMakeupLook}`, 20, tempCanvas.height - 55);
            tempCtx.fillText(`Eyebrow Style: ${currentEyebrowStyle}`, 20, tempCanvas.height - 30);
            
            // Convert to image and download
            const link = document.createElement('a');
            link.download = `glowai-makeup-${currentMakeupLook}-${new Date().getTime()}.png`;
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
            
            // Show feedback
            const originalText = captureButton.innerHTML;
            captureButton.innerHTML = '<i class="fas fa-check"></i> Captured!';
            setTimeout(() => {
                captureButton.innerHTML = originalText;
            }, 2000);
        }
        
        // Process face mesh results
        function onFaceMeshResults(results) {
            // Update canvas dimensions if needed
            if (outputCanvas.width !== inputVideo.videoWidth || outputCanvas.height !== inputVideo.videoHeight) {
                outputCanvas.width = inputVideo.videoWidth;
                outputCanvas.height = inputVideo.videoHeight;
            }
            
            // Clear canvas
            outputCtx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);
            
            // Draw video frame
            outputCtx.save();
            outputCtx.scale(-1, 1);
            outputCtx.translate(-outputCanvas.width, 0);
            outputCtx.drawImage(results.image, 0, 0, outputCanvas.width, outputCanvas.height);
            outputCtx.restore();
            
            // Check if face is detected
            if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                faceDetected = true;
                lastFaceLandmarks = results.multiFaceLandmarks[0];
                
                // Update UI with detection info
                landmarksCount.textContent = lastFaceLandmarks.length;
                
                // Draw face landmarks (optional, for debugging)
                // drawFaceLandmarks(lastFaceLandmarks);
                
                // Apply virtual makeup based on face landmarks
                applyVirtualMakeup();
                
                // Update face analysis
                updateFaceAnalysis();
            } else {
                faceDetected = false;
                landmarksCount.textContent = '0';
            }
        }
        
        // Draw face landmarks (for debugging/visualization)
        function drawFaceLandmarks(landmarks) {
            outputCtx.save();
            outputCtx.scale(-1, 1);
            outputCtx.translate(-outputCanvas.width, 0);
            
            outputCtx.fillStyle = 'rgba(255, 102, 178, 0.5)';
            for (const landmark of landmarks) {
                const x = landmark.x * outputCanvas.width;
                const y = landmark.y * outputCanvas.height;
                
                outputCtx.beginPath();
                outputCtx.arc(x, y, 2, 0, Math.PI * 2);
                outputCtx.fill();
            }
            
            outputCtx.restore();
        }
        
        // Apply virtual makeup based on current settings
        function applyVirtualMakeup() {
            if (!faceDetected || !lastFaceLandmarks) return;
            
            outputCtx.save();
            outputCtx.scale(-1, 1);
            outputCtx.translate(-outputCanvas.width, 0);
            
            // Apply makeup based on selected look
            switch(currentMakeupLook) {
                case 'natural':
                    applyNaturalMakeup();
                    break;
                case 'glam':
                    applyGlamMakeup();
                    break;
                case 'bold':
                    applyBoldMakeup();
                    break;
                case 'soft':
                    applySoftMakeup();
                    break;
            }
            
            // Apply eyebrows
            applyEyebrows();
            
            outputCtx.restore();
        }
        
        // Apply natural day makeup
        function applyNaturalMakeup() {
            if (!lastFaceLandmarks) return;
            
            const intensity = makeupIntensity;
            
            // Lips (natural tint)
            const lipTop = lastFaceLandmarks[13];  // Upper lip center
            const lipBottom = lastFaceLandmarks[14]; // Lower lip center
            
            if (lipTop && lipBottom) {
                const lipWidth = Math.abs(lastFaceLandmarks[308].x - lastFaceLandmarks[78].x) * outputCanvas.width * 1.2;
                const lipHeight = Math.abs(lipBottom.y - lipTop.y) * outputCanvas.height * 1.5;
                const lipX = lipTop.x * outputCanvas.width - lipWidth/2;
                const lipY = lipTop.y * outputCanvas.height - lipHeight/4;
                
                // Create lip color with opacity
                const lipColor = `rgba(255, 150, 180, ${0.3 + lipOpacity * 0.5})`;
                
                outputCtx.fillStyle = lipColor;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/2, lipY + lipHeight/2, lipWidth/2, lipHeight/2, 0, 0, Math.PI * 2);
                outputCtx.fill();
            }
            
            // Blush (subtle)
            const leftCheek = lastFaceLandmarks[234];  // Left cheek
            const rightCheek = lastFaceLandmarks[454]; // Right cheek (mirrored)
            
            if (leftCheek && rightCheek) {
                const blushRadius = 30 * intensity;
                const blushColor = `rgba(255, 200, 220, ${0.2 + intensity * 0.3})`;
                
                // Left cheek blush
                outputCtx.fillStyle = blushColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftCheek.x * outputCanvas.width, 
                    leftCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right cheek blush
                outputCtx.beginPath();
                outputCtx.arc(
                    rightCheek.x * outputCanvas.width, 
                    rightCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
            
            // Eyeshadow (neutral)
            const leftEye = lastFaceLandmarks[33];   // Left eye center
            const rightEye = lastFaceLandmarks[263]; // Right eye center
            
            if (leftEye && rightEye) {
                const eyeRadius = 25 * intensity;
                const eyeshadowColor = `rgba(180, 160, 140, ${0.1 + intensity * 0.2})`;
                
                // Left eye shadow
                outputCtx.fillStyle = eyeshadowColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftEye.x * outputCanvas.width, 
                    leftEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right eye shadow
                outputCtx.beginPath();
                outputCtx.arc(
                    rightEye.x * outputCanvas.width, 
                    rightEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
        }
        
        // Apply glam evening makeup
        function applyGlamMakeup() {
            if (!lastFaceLandmarks) return;
            
            const intensity = makeupIntensity;
            
            // Lips (bold red)
            const lipTop = lastFaceLandmarks[13];
            const lipBottom = lastFaceLandmarks[14];
            
            if (lipTop && lipBottom) {
                const lipWidth = Math.abs(lastFaceLandmarks[308].x - lastFaceLandmarks[78].x) * outputCanvas.width * 1.3;
                const lipHeight = Math.abs(lipBottom.y - lipTop.y) * outputCanvas.height * 1.6;
                const lipX = lipTop.x * outputCanvas.width - lipWidth/2;
                const lipY = lipTop.y * outputCanvas.height - lipHeight/4;
                
                const lipColor = `rgba(200, 50, 80, ${0.5 + lipOpacity * 0.5})`;
                
                outputCtx.fillStyle = lipColor;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/2, lipY + lipHeight/2, lipWidth/2, lipHeight/2, 0, 0, Math.PI * 2);
                outputCtx.fill();
                
                // Add lip shine
                outputCtx.fillStyle = `rgba(255, 255, 255, ${0.3})`;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/2, lipY + lipHeight/3, lipWidth/4, lipHeight/6, 0, 0, Math.PI * 2);
                outputCtx.fill();
            }
            
            // Contour
            const contourPoints = [
                lastFaceLandmarks[234],  // Left cheek contour
                lastFaceLandmarks[454],  // Right cheek contour
                lastLandmarkByIndex(152), // Jawline left
                lastLandmarkByIndex(377)  // Jawline right
            ];
            
            if (contourPoints.every(p => p)) {
                const contourColor = `rgba(100, 80, 120, ${0.1 + intensity * 0.3})`;
                outputCtx.fillStyle = contourColor;
                
                contourPoints.forEach(point => {
                    outputCtx.beginPath();
                    outputCtx.arc(
                        point.x * outputCanvas.width, 
                        point.y * outputCanvas.height, 
                        35 * intensity, 0, Math.PI * 2
                    );
                    outputCtx.fill();
                });
            }
            
            // Dramatic eyeshadow
            const leftEye = lastFaceLandmarks[33];
            const rightEye = lastFaceLandmarks[263];
            
            if (leftEye && rightEye) {
                const eyeRadius = 40 * intensity;
                const eyeshadowColor = `rgba(80, 60, 120, ${0.3 + intensity * 0.4})`;
                
                // Left eye shadow
                outputCtx.fillStyle = eyeshadowColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftEye.x * outputCanvas.width, 
                    leftEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right eye shadow
                outputCtx.beginPath();
                outputCtx.arc(
                    rightEye.x * outputCanvas.width, 
                    rightEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Eyeliner
                const eyelinerColor = `rgba(0, 0, 0, ${0.7 + intensity * 0.3})`;
                outputCtx.strokeStyle = eyelinerColor;
                outputCtx.lineWidth = 3 + intensity * 5;
                
                // Left eyeliner wing
                outputCtx.beginPath();
                outputCtx.moveTo(leftEye.x * outputCanvas.width - 20, leftEye.y * outputCanvas.height - 10);
                outputCtx.lineTo(leftEye.x * outputCanvas.width - 50, leftEye.y * outputCanvas.height - 30);
                outputCtx.stroke();
                
                // Right eyeliner wing
                outputCtx.beginPath();
                outputCtx.moveTo(rightEye.x * outputCanvas.width + 20, rightEye.y * outputCanvas.height - 10);
                outputCtx.lineTo(rightEye.x * outputCanvas.width + 50, rightEye.y * outputCanvas.height - 30);
                outputCtx.stroke();
            }
        }
        
        // Apply bold & bright makeup
        function applyBoldMakeup() {
            if (!lastFaceLandmarks) return;
            
            const intensity = makeupIntensity;
            
            // Bright lips
            const lipTop = lastFaceLandmarks[13];
            const lipBottom = lastFaceLandmarks[14];
            
            if (lipTop && lipBottom) {
                const lipWidth = Math.abs(lastFaceLandmarks[308].x - lastFaceLandmarks[78].x) * outputCanvas.width * 1.4;
                const lipHeight = Math.abs(lipBottom.y - lipTop.y) * outputCanvas.height * 1.7;
                const lipX = lipTop.x * outputCanvas.width - lipWidth/2;
                const lipY = lipTop.y * outputCanvas.height - lipHeight/4;
                
                // Bright coral/orange color
                const lipColor = `rgba(255, 100, 80, ${0.6 + lipOpacity * 0.4})`;
                
                outputCtx.fillStyle = lipColor;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/2, lipY + lipHeight/2, lipWidth/2, lipHeight/2, 0, 0, Math.PI * 2);
                outputCtx.fill();
            }
            
            // Colorful eyeshadow
            const leftEye = lastFaceLandmarks[33];
            const rightEye = lastFaceLandmarks[263];
            
            if (leftEye && rightEye) {
                const eyeRadius = 45 * intensity;
                
                // Blue eyeshadow for left eye
                const leftEyeColor = `rgba(80, 150, 255, ${0.4 + intensity * 0.4})`;
                outputCtx.fillStyle = leftEyeColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftEye.x * outputCanvas.width, 
                    leftEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Purple eyeshadow for right eye
                const rightEyeColor = `rgba(180, 80, 220, ${0.4 + intensity * 0.4})`;
                outputCtx.fillStyle = rightEyeColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    rightEye.x * outputCanvas.width, 
                    rightEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
            
            // Bright blush
            const leftCheek = lastFaceLandmarks[234];
            const rightCheek = lastFaceLandmarks[454];
            
            if (leftCheek && rightCheek) {
                const blushRadius = 35 * intensity;
                const blushColor = `rgba(255, 120, 160, ${0.4 + intensity * 0.4})`;
                
                // Left cheek blush
                outputCtx.fillStyle = blushColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftCheek.x * outputCanvas.width, 
                    leftCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right cheek blush
                outputCtx.beginPath();
                outputCtx.arc(
                    rightCheek.x * outputCanvas.width, 
                    rightCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
        }
        
        // Apply soft romantic makeup
        function applySoftMakeup() {
            if (!lastFaceLandmarks) return;
            
            const intensity = makeupIntensity;
            
            // Soft pink lips
            const lipTop = lastFaceLandmarks[13];
            const lipBottom = lastFaceLandmarks[14];
            
            if (lipTop && lipBottom) {
                const lipWidth = Math.abs(lastFaceLandmarks[308].x - lastFaceLandmarks[78].x) * outputCanvas.width * 1.2;
                const lipHeight = Math.abs(lipBottom.y - lipTop.y) * outputCanvas.height * 1.5;
                const lipX = lipTop.x * outputCanvas.width - lipWidth/2;
                const lipY = lipTop.y * outputCanvas.height - lipHeight/4;
                
                const lipColor = `rgba(255, 180, 200, ${0.4 + lipOpacity * 0.4})`;
                
                outputCtx.fillStyle = lipColor;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/2, lipY + lipHeight/2, lipWidth/2, lipHeight/2, 0, 0, Math.PI * 2);
                outputCtx.fill();
                
                // Glossy effect
                outputCtx.fillStyle = `rgba(255, 255, 255, ${0.4})`;
                outputCtx.beginPath();
                outputCtx.ellipse(lipX + lipWidth/3, lipY + lipHeight/3, lipWidth/6, lipHeight/8, 0, 0, Math.PI * 2);
                outputCtx.fill();
            }
            
            // Soft blush
            const leftCheek = lastFaceLandmarks[234];
            const rightCheek = lastFaceLandmarks[454];
            
            if (leftCheek && rightCheek) {
                const blushRadius = 40 * intensity;
                const blushColor = `rgba(255, 200, 220, ${0.3 + intensity * 0.3})`;
                
                // Left cheek blush
                outputCtx.fillStyle = blushColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftCheek.x * outputCanvas.width, 
                    leftCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right cheek blush
                outputCtx.beginPath();
                outputCtx.arc(
                    rightCheek.x * outputCanvas.width, 
                    rightCheek.y * outputCanvas.height, 
                    blushRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
            
            // Shimmery eyeshadow
            const leftEye = lastFaceLandmarks[33];
            const rightEye = lastFaceLandmarks[263];
            
            if (leftEye && rightEye) {
                const eyeRadius = 35 * intensity;
                const eyeshadowColor = `rgba(255, 220, 180, ${0.2 + intensity * 0.3})`;
                
                // Left eye shadow
                outputCtx.fillStyle = eyeshadowColor;
                outputCtx.beginPath();
                outputCtx.arc(
                    leftEye.x * outputCanvas.width, 
                    leftEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right eye shadow
                outputCtx.beginPath();
                outputCtx.arc(
                    rightEye.x * outputCanvas.width, 
                    rightEye.y * outputCanvas.height, 
                    eyeRadius, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Inner corner highlight
                const highlightColor = `rgba(255, 255, 220, ${0.6 + intensity * 0.4})`;
                outputCtx.fillStyle = highlightColor;
                
                // Left inner corner
                outputCtx.beginPath();
                outputCtx.arc(
                    leftEye.x * outputCanvas.width - 15, 
                    leftEye.y * outputCanvas.height, 
                    8 * intensity, 0, Math.PI * 2
                );
                outputCtx.fill();
                
                // Right inner corner
                outputCtx.beginPath();
                outputCtx.arc(
                    rightEye.x * outputCanvas.width + 15, 
                    rightEye.y * outputCanvas.height, 
                    8 * intensity, 0, Math.PI * 2
                );
                outputCtx.fill();
            }
        }
        
        // Apply eyebrow styles
        function applyEyebrows() {
            if (!lastFaceLandmarks) return;
            
            const leftBrowPoints = [
                lastLandmarkByIndex(70),   // Left brow inner
                lastLandmarkByIndex(63),   // Left brow center
                lastLandmarkByIndex(105)   // Left brow outer
            ];
            
            const rightBrowPoints = [
                lastLandmarkByIndex(336),  // Right brow inner
                lastLandmarkByIndex(296),  // Right brow center
                lastLandmarkByIndex(334)   // Right brow outer
            ];
            
            if (leftBrowPoints.every(p => p) && rightBrowPoints.every(p => p)) {
                const browColor = `rgba(80, 60, 40, ${0.7 + makeupIntensity * 0.3})`;
                outputCtx.fillStyle = browColor;
                outputCtx.strokeStyle = browColor;
                outputCtx.lineWidth = 4 + makeupIntensity * 6;
                outputCtx.lineCap = 'round';
                outputCtx.lineJoin = 'round';
                
                // Apply different eyebrow shapes
                switch(currentEyebrowStyle) {
                    case 'soft-arch':
                        // Left eyebrow (soft arch)
                        outputCtx.beginPath();
                        outputCtx.moveTo(leftBrowPoints[0].x * outputCanvas.width, leftBrowPoints[0].y * outputCanvas.height);
                        outputCtx.quadraticCurveTo(
                            leftBrowPoints[1].x * outputCanvas.width, 
                            leftBrowPoints[1].y * outputCanvas.height - 15,
                            leftBrowPoints[2].x * outputCanvas.width, 
                            leftBrowPoints[2].y * outputCanvas.height
                        );
                        outputCtx.stroke();
                        
                        // Right eyebrow (soft arch)
                        outputCtx.beginPath();
                        outputCtx.moveTo(rightBrowPoints[0].x * outputCanvas.width, rightBrowPoints[0].y * outputCanvas.height);
                        outputCtx.quadraticCurveTo(
                            rightBrowPoints[1].x * outputCanvas.width, 
                            rightBrowPoints[1].y * outputCanvas.height - 15,
                            rightBrowPoints[2].x * outputCanvas.width, 
                            rightBrowPoints[2].y * outputCanvas.height
                        );
                        outputCtx.stroke();
                        break;
                        
                    case 'straight':
                        // Left eyebrow (straight)
                        outputCtx.beginPath();
                        outputCtx.moveTo(leftBrowPoints[0].x * outputCanvas.width, leftBrowPoints[0].y * outputCanvas.height);
                        outputCtx.lineTo(leftBrowPoints[2].x * outputCanvas.width, leftBrowPoints[2].y * outputCanvas.height);
                        outputCtx.stroke();
                        
                        // Right eyebrow (straight)
                        outputCtx.beginPath();
                        outputCtx.moveTo(rightBrowPoints[0].x * outputCanvas.width, rightBrowPoints[0].y * outputCanvas.height);
                        outputCtx.lineTo(rightBrowPoints[2].x * outputCanvas.width, rightBrowPoints[2].y * outputCanvas.height);
                        outputCtx.stroke();
                        break;
                        
                    case 'rounded':
                        // Left eyebrow (rounded)
                        outputCtx.beginPath();
                        outputCtx.moveTo(leftBrowPoints[0].x * outputCanvas.width, leftBrowPoints[0].y * outputCanvas.height);
                        outputCtx.quadraticCurveTo(
                            leftBrowPoints[1].x * outputCanvas.width, 
                            leftBrowPoints[1].y * outputCanvas.height - 25,
                            leftBrowPoints[2].x * outputCanvas.width, 
                            leftBrowPoints[2].y * outputCanvas.height + 5
                        );
                        outputCtx.stroke();
                        
                        // Right eyebrow (rounded)
                        outputCtx.beginPath();
                        outputCtx.moveTo(rightBrowPoints[0].x * outputCanvas.width, rightBrowPoints[0].y * outputCanvas.height);
                        outputCtx.quadraticCurveTo(
                            rightBrowPoints[1].x * outputCanvas.width, 
                            rightBrowPoints[1].y * outputCanvas.height - 25,
                            rightBrowPoints[2].x * outputCanvas.width, 
                            rightBrowPoints[2].y * outputCanvas.height + 5
                        );
                        outputCtx.stroke();
                        break;
                        
                    case 's-shaped':
                        // Left eyebrow (S-shaped)
                        outputCtx.beginPath();
                        outputCtx.moveTo(leftBrowPoints[0].x * outputCanvas.width, leftBrowPoints[0].y * outputCanvas.height);
                        outputCtx.bezierCurveTo(
                            leftBrowPoints[0].x * outputCanvas.width + 20, 
                            leftBrowPoints[0].y * outputCanvas.height - 10,
                            leftBrowPoints[1].x * outputCanvas.width - 10, 
                            leftBrowPoints[1].y * outputCanvas.height + 5,
                            leftBrowPoints[2].x * outputCanvas.width, 
                            leftBrowPoints[2].y * outputCanvas.height
                        );
                        outputCtx.stroke();
                        
                        // Right eyebrow (S-shaped)
                        outputCtx.beginPath();
                        outputCtx.moveTo(rightBrowPoints[0].x * outputCanvas.width, rightBrowPoints[0].y * outputCanvas.height);
                        outputCtx.bezierCurveTo(
                            rightBrowPoints[0].x * outputCanvas.width - 20, 
                            rightBrowPoints[0].y * outputCanvas.height - 10,
                            rightBrowPoints[1].x * outputCanvas.width + 10, 
                            rightBrowPoints[1].y * outputCanvas.height + 5,
                            rightBrowPoints[2].x * outputCanvas.width, 
                            rightBrowPoints[2].y * outputCanvas.height
                        );
                        outputCtx.stroke();
                        break;
                }
            }
        }
        
        // Helper function to get landmark by index
        function lastLandmarkByIndex(index) {
            if (!lastFaceLandmarks || index >= lastFaceLandmarks.length) return null;
            return lastFaceLandmarks[index];
        }
        
        // Update face analysis based on detected landmarks
        function updateFaceAnalysis() {
            if (!lastFaceLandmarks) return;
            
            // Update face shape based on face proportions
            const faceWidth = Math.abs(lastFaceLandmarks[454].x - lastFaceLandmarks[234].x) * outputCanvas.width;
            const faceHeight = Math.abs(lastFaceLandmarks[152].y - lastFaceLandmarks[10].y) * outputCanvas.height;
            const faceRatio = faceWidth / faceHeight;
            
            let faceShape = "Oval";
            if (faceRatio > 0.85) faceShape = "Round";
            else if (faceRatio > 0.75) faceShape = "Square";
            else if (faceRatio < 0.65) faceShape = "Long";
            
            faceShapeValue.textContent = faceShape;
            
            // Update skin tone (simulated based on face region color)
            // In a real app, you would sample the skin color from the video
            const skinTones = [
                {name: "Fair Ivory", color: "#f5e1d2"},
                {name: "Light Beige", color: "#e8c8af"},
                {name: "Medium Warm", color: "#d8b08c"},
                {name: "Olive Tone", color: "#c19a6b"},
                {name: "Deep Mahogany", color: "#8d5524"}
            ];
            
            // Simulate skin tone detection (in reality you'd analyze the video pixels)
            // For demo, we'll just pick one based on face shape
            const toneIndex = Math.min(faceShape.length % skinTones.length, skinTones.length - 1);
            skinToneValue.textContent = skinTones[toneIndex].name;
            skinTonePreview.style.backgroundColor = skinTones[toneIndex].color;
        }
        
        // Event Listeners
        startButton.addEventListener('click', startCamera);
        stopButton.addEventListener('click', stopCamera);
        captureButton.addEventListener('click', captureLook);
        
        // Makeup look selection
        makeupOptions.forEach(option => {
            option.addEventListener('click', function() {
                makeupOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                currentMakeupLook = this.getAttribute('data-look');
                
                // Update instructions
                updateInstructions(currentMakeupLook);
                
                // Re-apply makeup with new look
                if (faceDetected) {
                    applyVirtualMakeup();
                }
            });
        });
        
        // Eyebrow style selection
        eyebrowSamples.forEach(sample => {
            sample.addEventListener('click', function() {
                eyebrowSamples.forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                currentEyebrowStyle = this.getAttribute('data-brow');
                
                // Re-apply eyebrows
                if (faceDetected) {
                    applyVirtualMakeup();
                }
            });
        });
        
        // Intensity slider
        intensitySlider.addEventListener('input', function() {
            makeupIntensity = this.value / 100;
            intensityValue.textContent = `${this.value}%`;
            makeupIntensityValue.textContent = `${this.value}%`;
            
            if (faceDetected) {
                applyVirtualMakeup();
            }
        });
        
        // Lip opacity slider
        lipOpacitySlider.addEventListener('input', function() {
            lipOpacity = this.value / 100;
            lipOpacityValue.textContent = `${this.value}%`;
            
            if (faceDetected) {
                applyVirtualMakeup();
            }
        });
        
        // Update instructions based on selected makeup look
        function updateInstructions(look) {
            const instructionsContent = document.getElementById('instructionsContent');
            
            let instructionsHTML = '';
            
            if (look === 'natural') {
                instructionsHTML = `
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Natural Foundation</h4>
                            <p>Apply a light coverage foundation or tinted moisturizer for an even base that looks like skin.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Soft Eyebrows</h4>
                            <p>Fill in sparse areas with hair-like strokes using a brow pencil one shade lighter than your brows.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Neutral Eyes</h4>
                            <p>Apply a matte neutral shadow close to your skin tone. Curl lashes and apply one coat of brown mascara.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Finish with Tinted Lip Balm</h4>
                            <p>Apply a tinted lip balm or sheer lipstick in a "my lips but better" shade for a natural finish.</p>
                        </div>
                    </div>
                `;
            } else if (look === 'glam') {
                instructionsHTML = `
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Flawless Base</h4>
                            <p>Start with primer, then apply full-coverage foundation. Conceal under eyes and any imperfections.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Contour & Highlight</h4>
                            <p>Sculpt cheekbones, jawline, and nose with cream contour. Highlight cheekbones, brow bone, and cupid's bow.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Smoky Eye</h4>
                            <p>Apply dark eyeshadow to outer corners, blending inward. Add shimmer to center of lids. Create winged eyeliner.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Bold Lips & Lashes</h4>
                            <p>Line and fill lips with a bold color. Apply false lashes or multiple coats of volumizing mascara.</p>
                        </div>
                    </div>
                `;
            } else if (look === 'bold') {
                instructionsHTML = `
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Even Canvas</h4>
                            <p>Apply medium-coverage foundation for a clean base that allows colorful makeup to stand out.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Colorful Eyeshadow</h4>
                            <p>Apply vibrant eyeshadow (blue, purple, or green) to lids, blending well at the edges.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Graphic Eyeliner</h4>
                            <p>Use colorful liquid eyeliner to create a graphic wing or double line above your lash line.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Bold Blush & Lips</h4>
                            <p>Apply bright blush high on cheekbones. Choose a lip color that complements or contrasts with your eye look.</p>
                        </div>
                    </div>
                `;
            } else if (look === 'soft') {
                instructionsHTML = `
                    <div class="instruction-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Dewy Foundation</h4>
                            <p>Use a luminous foundation or mix liquid highlighter with foundation for a dewy finish.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Cream Blush</h4>
                            <p>Apply cream blush in pink or peach to apples of cheeks and blend upward toward temples.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Shimmery Eyes</h4>
                            <p>Apply light shimmery shadow (champagne or rose gold) across lids and inner corners.</p>
                        </div>
                    </div>
                    <div class="instruction-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Glossy Lips</h4>
                            <p>Apply a lip tint followed by clear or tinted gloss. Add subtle highlight to cheekbones.</p>
                        </div>
                    </div>
                `;
            }
            
            instructionsContent.innerHTML = instructionsHTML;
        }
        
        // Initialize with natural look instructions
        updateInstructions('natural');
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Pre-initialize face mesh for faster startup
            initializeFaceMesh();
            
            // Select first eyebrow by default
            document.querySelector('.eyebrow-sample').classList.add('selected');
        });
    </script>
</body>
</html>
