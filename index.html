<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Launch Auto-Click Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 40px;
            background: #1a1a2e;
            color: white;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-area {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .app-link {
            display: block;
            padding: 15px;
            margin: 10px 0;
            background: rgba(66, 133, 244, 0.3);
            border-radius: 5px;
            color: white;
            text-decoration: none;
            border: 1px solid #4285f4;
        }
        .app-link:hover {
            background: rgba(66, 133, 244, 0.5);
        }
        .file-link {
            display: block;
            padding: 15px;
            margin: 10px 0;
            background: rgba(234, 67, 53, 0.3);
            border-radius: 5px;
            color: white;
            text-decoration: none;
            border: 1px solid #ea4335;
        }
        .file-link:hover {
            background: rgba(234, 67, 53, 0.5);
        }
        .status {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', monospace;
            margin: 20px 0;
            height: 300px;
            overflow-y: auto;
        }
        .success { color: #00ff88; }
        .warning { color: #ffaa00; }
        .error { color: #ff4444; }
        .critical { color: #ff4444; font-weight: bold; }
        .info { color: #4285f4; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ App & File Launch Auto-Click Test</h1>
        
        <div class="test-area">
            <h3>Test App Launch Links</h3>
            
            <!-- Common macOS app URL schemes -->
            <a href="safari://" class="app-link">ğŸŒ safari://</a>
            <a href="safari://open?url=https://apple.com" class="app-link">ğŸŒ safari://open?url=https://apple.com</a>
            <a href="x-apple-music://" class="app-link">ğŸµ x-apple-music://</a>
            <a href="facetime://+1234567890" class="app-link">ğŸ“ facetime://+1234567890</a>
            <a href="mailto:test@example.com" class="app-link">ğŸ“§ mailto:test@example.com</a>
            <a href="messages://" class="app-link">ğŸ’¬ messages://</a>
            <a href="maps://" class="app-link">ğŸ—ºï¸ maps://</a>
            <a href="itms-apps://" class="app-link">ğŸ“± itms-apps:// (App Store)</a>
            <a href="itms://" class="app-link">ğŸ“± itms:// (iTunes Store)</a>
            
            <!-- Custom app schemes (if any are registered) -->
            <a href="twitter://" class="app-link">ğŸ¦ twitter://</a>
            <a href="whatsapp://" class="app-link">ğŸ’š whatsapp://</a>
            <a href="spotify://" class="app-link">ğŸ¶ spotify://</a>

            <!-- File protocol links for testing -->
            <h3 style="margin-top: 30px;">Test File Protocol Links</h3>
            <a href="file:///Users/Shared/" class="file-link" aria-label="Open file:///Users/Shared/">ğŸ“ file:///Users/Shared/ (aria-label)</a>
            <a href="file:///Users/Shared/" class="file-link" title="Shared Folder">ğŸ“ file:///Users/Shared/ (title)</a>
            <a href="file:///Users/Shared/" class="file-link">ğŸ“ file:///Users/Shared/ (basic)</a>
            <button class="file-link" onclick="window.location.href='file:///Users/Shared/'">ğŸ“ Button to file:///Users/Shared/</button>
            
            <button onclick="startAppAutoClicker()">Start App Auto-Clicker</button>
            <button onclick="startFileAutoClicker()">Start File Auto-Clicker</button>
            <button onclick="stopAllAutoClickers()">Stop All Auto-Clickers</button>
        </div>

        <div class="status" id="status">
            Status: Testing automated app and file launch clicking...
        </div>
    </div>

    <script>
        const statusElement = document.getElementById('status');
        let appAutoClickerInterval = null;
        let fileAutoClickerInterval = null;
        let appClickCount = 0;
        let fileClickCount = 0;

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            statusElement.appendChild(entry);
            statusElement.scrollTop = statusElement.scrollHeight;
        }

        function startAppAutoClicker() {
            if (appAutoClickerInterval) {
                log('âŒ App auto-clicker already running', 'warning');
                return;
            }

            log('ğŸš€ Starting app launch auto-clicker...', 'warning');
            log('âš ï¸ Will attempt to click app links every 3 seconds', 'warning');

            appAutoClickerInterval = setInterval(() => {
                appClickCount++;
                log(`ğŸ”„ App auto-click attempt #${appClickCount}`, 'info');
                
                // Strategy 1: Click all app scheme links
                const appSchemes = [
                    'safari://', 'x-apple-music://', 'facetime://', 'mailto:',
                    'messages://', 'maps://', 'itms-apps://', 'itms://',
                    'twitter://', 'whatsapp://', 'spotify://'
                ];
                
                let foundLinks = [];
                
                appSchemes.forEach(scheme => {
                    const links = document.querySelectorAll(`a[href^="${scheme}"]`);
                    links.forEach(link => foundLinks.push(link));
                });
                
                if (foundLinks.length > 0) {
                    log(`âœ… Found ${foundLinks.length} app launch links`, 'success');
                    
                    foundLinks.forEach((link, index) => {
                        setTimeout(() => {
                            log(`ğŸ–±ï¸ Clicking app link: ${link.href}`, 'warning');
                            
                            // Visual feedback
                            const originalBg = link.style.backgroundColor;
                            link.style.backgroundColor = '#34a853';
                            
                            setTimeout(() => {
                                try {
                                    link.click();
                                    log(`âœ… App link click dispatched: ${link.href}`, 'success');
                                    log('ğŸ’¡ If app opens, this is a security issue!', 'critical');
                                } catch (e) {
                                    log(`âŒ App link click failed: ${e.message}`, 'error');
                                }
                                link.style.backgroundColor = originalBg;
                            }, 100);
                            
                        }, index * 500);
                    });
                } else {
                    log('âŒ No app launch links found', 'error');
                }
                
                // Strategy 2: Try window.location with app schemes
                if (appClickCount % 3 === 0) {
                    const testSchemes = [
                        'safari://',
                        'facetime://+1234567890',
                        'mailto:test@example.com'
                    ];
                    
                    testSchemes.forEach(scheme => {
                        setTimeout(() => {
                            log(`ğŸ”„ Trying window.location: ${scheme}`, 'info');
                            try {
                                window.location.href = scheme;
                                log(`âœ… window.location attempted: ${scheme}`, 'success');
                            } catch (e) {
                                log(`âŒ window.location failed: ${e.message}`, 'error');
                            }
                        }, 1500);
                    });
                }
                
                // Strategy 3: Try window.open with app schemes
                if (appClickCount % 4 === 0) {
                    setTimeout(() => {
                        log('ğŸ”„ Trying window.open with app schemes', 'info');
                        try {
                            const newWindow = window.open('safari://', '_blank');
                            if (newWindow) {
                                log('âœ… window.open succeeded (app may launch)', 'success');
                            } else {
                                log('âŒ window.open was blocked', 'error');
                            }
                        } catch (e) {
                            log(`âŒ window.open error: ${e.message}`, 'error');
                        }
                    }, 6000);
                }
                
            }, 6000); // 3 seconds

            log('âœ… App auto-clicker started', 'success');
        }

        function startFileAutoClicker() {
            if (fileAutoClickerInterval) {
                log('âŒ File auto-clicker already running', 'warning');
                return;
            }

            log('ğŸ“ Starting file protocol auto-clicker...', 'warning');
            log('âš ï¸ Will attempt to click file:// links every 50 seconds', 'warning');

            fileAutoClickerInterval = setInterval(() => {
                fileClickCount++;
                log(`ğŸ“ File auto-click attempt #${fileClickCount}`, 'info');
                
                // Enhanced selector strategy for file links
                const selectors = [
                    'a[aria-label*="file:///Users/Shared/"]',
                    'a[href*="file:///Users/Shared/"]',
                    'a[title*="Shared"]',
                    'button[aria-label*="Shared"]',
                    '[onclick*="file:///Users/Shared/"]'
                ];
                
                let clicked = false;
                
                for (const selector of selectors) {
                    const element = document.querySelector(selector);
                    if (element) {
                        log(`ğŸ–±ï¸ Clicking file link with selector: ${selector}`, 'warning');
                        
                        // Visual feedback
                        const originalBg = element.style.backgroundColor;
                        element.style.backgroundColor = '#ea4335';
                        
                        try {
                            element.click();
                            log(`âœ… File link click dispatched: ${selector}`, 'success');
                            log('ğŸ’¡ If file opens in Finder, this is a security finding!', 'critical');
                            clicked = true;
                        } catch (e) {
                            log(`âŒ File link click failed: ${e.message}`, 'error');
                        }
                        
                        setTimeout(() => {
                            element.style.backgroundColor = originalBg;
                        }, 1000);
                        
                        break;
                    }
                }
                
                if (!clicked) {
                    log('âŒ No file protocol links found with current selectors', 'error');
                }
                
            }, 5000); // 50 seconds

            log('âœ… File auto-clicker started', 'success');
        }

        function stopAllAutoClickers() {
            let stopped = false;
            
            if (appAutoClickerInterval) {
                clearInterval(appAutoClickerInterval);
                appAutoClickerInterval = null;
                log('ğŸ›‘ App auto-clicker stopped', 'success');
                stopped = true;
            }
            
            if (fileAutoClickerInterval) {
                clearInterval(fileAutoClickerInterval);
                fileAutoClickerInterval = null;
                log('ğŸ›‘ File auto-clicker stopped', 'success');
                stopped = true;
            }
            
            if (!stopped) {
                log('â„¹ï¸ No auto-clickers were running', 'info');
            }
        }

        // Monitor for app launch attempts
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && e.target.href) {
                const href = e.target.href;
                if (href.startsWith('safari://') || href.startsWith('facetime://') || 
                    href.startsWith('mailto:') || href.startsWith('x-apple-music://')) {
                    log(`ğŸ¯ App link click detected: ${href}`, 'warning');
                } else if (href.startsWith('file://')) {
                    log(`ğŸ“ File link click detected: ${href}`, 'critical');
                }
            }
        });

        // Listen for page navigation (would trigger if app launches)
        window.addEventListener('beforeunload', (e) => {
            log('ğŸš¨ PAGE NAVIGATION DETECTED - App or file may be launching!', 'critical');
            // Don't prevent default - we want to see if navigation happens
        });

        // Test iframes with app schemes (another potential vector)
        function testIframeAppLaunch() {
            log('ğŸ”„ Testing iframe app launches...', 'info');
            const appSchemes = ['safari://', 'facetime://+1234567890'];
            
            appSchemes.forEach(scheme => {
                setTimeout(() => {
                    try {
                        const iframe = document.createElement('iframe');
                        iframe.style.display = 'none';
                        iframe.src = scheme;
                        document.body.appendChild(iframe);
                        log(`âœ… Iframe created with: ${scheme}`, 'success');
                        setTimeout(() => document.body.removeChild(iframe), 1000);
                    } catch (e) {
                        log(`âŒ Iframe failed: ${e.message}`, 'error');
                    }
                }, 500);
            });
        }

        // Auto-start with delay
        setTimeout(() => {
            log('ğŸ”§ Initializing app and file launch tests...', 'info');
            log('ğŸ’¡ App schemes often have different security rules than file://', 'warning');
            log('ğŸ¯ If apps or files open automatically, this is a significant finding!', 'critical');
            
            setTimeout(startAppAutoClicker, 2000);
            setTimeout(startFileAutoClicker, 10000); // Start file clicker after 10 seconds
            setTimeout(testIframeAppLaunch, 5000);
        }, 1000);

    </script>
</body>
</html>
