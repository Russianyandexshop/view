<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced File Protocol Bypass Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 40px;
            background: #1a1a2e;
            color: white;
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-area {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .file-link {
            display: block;
            padding: 15px;
            margin: 10px 0;
            background: rgba(66, 133, 244, 0.3);
            border-radius: 5px;
            color: white;
            text-decoration: none;
            border: 1px solid #4285f4;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-link:hover {
            background: rgba(66, 133, 244, 0.5);
        }
        .file-link.clicked {
            background: rgba(52, 168, 83, 0.7);
        }
        .file-link.failed {
            background: rgba(234, 67, 53, 0.7);
        }
        .status {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', monospace;
            margin: 20px 0;
            height: 400px;
            overflow-y: auto;
        }
        .success { color: #00ff88; }
        .warning { color: #ffaa00; }
        .error { color: #ff4444; }
        .critical { color: #ff4444; font-weight: bold; }
        .section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed rgba(255,255,255,0.2);
        }
        .section-title {
            color: #ffaa00;
            margin-bottom: 15px;
        }
        button {
            background: rgba(66, 133, 244, 0.6);
            color: white;
            border: 1px solid #4285f4;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: rgba(66, 133, 244, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Advanced File Protocol Bypass Tests</h1>
        
        <div class="test-area">
            <div class="section">
                <h3 class="section-title">Method 1: Traditional File Links (Expected to Fail)</h3>
                <a href="file:///Users/Shared/" class="file-link">üìÇ file:///Users/Shared/</a>
                <a href="file:///Applications/" class="file-link">üìÇ file:///Applications/</a>
                <a href="file:///System/Library/CoreServices/" class="file-link">üìÇ file:///System/Library/CoreServices/</a>
            </div>

            <div class="section">
                <h3 class="section-title">Method 2: User Gesture Bypass Attempts</h3>
                <button onclick="testUserGestureBypass()">Click + setTimeout Bypass</button>
                <button onclick="testDoubleClickBypass()">Double-Click Handler</button>
                <button onclick="testDragAndDropBypass()">Drag & Drop Simulation</button>
                <button onclick="testContextMenuBypass()">Right-Click Context Menu</button>
            </div>

            <div class="section">
                <h3 class="section-title">Method 3: Frame & Window Manipulation</h3>
                <button onclick="testIframeSandboxBypass()">Iframe Sandbox Bypass</button>
                <button onclick="testWindowOpenBypass()">window.open with file://</button>
                <button onclick="testLocationReplaceBypass()">location.replace()</button>
                <button onclick="testPostMessageBypass()">PostMessage to Iframe</button>
            </div>

            <div class="section">
                <h3 class="section-title">Method 4: Protocol Handler Tricks</h3>
                <button onclick="testCustomProtocol()">Custom Protocol Handler</button>
                <button onclick="testFileSystemAPI()">File System Access API</button>
                <button onclick="testBlobURLs()">Blob URLs with file://</button>
                <button onclick="testDataURIRedirect()">Data URI Redirect</button>
            </div>

            <div class="section">
                <h3 class="section-title">Method 5: Browser-Specific Exploits</h3>
                <button onclick="testSafariSpecific()">Safari-Specific Methods</button>
                <button onclick="testChromeSpecific()">Chrome-Specific Methods</button>
                <button onclick="testFirefoxSpecific()">Firefox-Specific Methods</button>
            </div>

            <button onclick="runAllTests()">üöÄ Run All Bypass Tests</button>
            <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
        </div>

        <div class="status" id="status">
            Status: Ready to test file protocol bypass methods...
        </div>
    </div>

    <script>
        const statusElement = document.getElementById('status');
        let testCount = 0;

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            statusElement.appendChild(entry);
            statusElement.scrollTop = statusElement.scrollHeight;
        }

        function clearLog() {
            statusElement.innerHTML = 'Status: Log cleared...';
        }

        // Method 2: User Gesture Bypass Attempts
        function testUserGestureBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: User Gesture + setTimeout Bypass`, 'warning');
            
            try {
                const link = document.createElement('a');
                link.href = 'file:///Users/Shared/';
                document.body.appendChild(link);
                
                // Try immediate click
                link.click();
                log('‚úÖ Immediate click after gesture attempted', 'success');
                
                // Try with minimal delay
                setTimeout(() => {
                    link.click();
                    log('‚úÖ Delayed click after gesture attempted', 'success');
                }, 10);
                
                document.body.removeChild(link);
            } catch(e) {
                log(`‚ùå User gesture bypass failed: ${e.message}`, 'error');
            }
        }

        function testDoubleClickBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: Double-Click Handler`, 'warning');
            
            const link = document.createElement('a');
            link.href = 'file:///Applications/';
            link.textContent = 'Double-click me';
            link.style.padding = '10px';
            link.style.background = 'rgba(255,0,0,0.3)';
            document.body.appendChild(link);
            
            let clickCount = 0;
            link.addEventListener('click', (e) => {
                clickCount++;
                if (clickCount === 2) {
                    log('üéØ Double-click detected, attempting bypass', 'critical');
                    window.open('file:///Users/Shared/', '_blank');
                }
                setTimeout(() => { clickCount = 0; }, 300);
            });
            
            setTimeout(() => document.body.removeChild(link), 5000);
        }

        function testDragAndDropBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: Drag & Drop Simulation`, 'warning');
            
            const dropZone = document.createElement('div');
            dropZone.style.padding = '20px';
            dropZone.style.background = 'rgba(0,255,0,0.2)';
            dropZone.style.border = '2px dashed green';
            dropZone.textContent = 'Drop files here (simulated)';
            document.body.appendChild(dropZone);
            
            try {
                const dropEvent = new DragEvent('drop', {
                    dataTransfer: {
                        items: [{
                            kind: 'file',
                            type: 'application/x-file-url'
                        }]
                    }
                });
                
                dropZone.dispatchEvent(dropEvent);
                log('‚úÖ Drag & drop event dispatched', 'success');
                
                setTimeout(() => {
                    window.location.href = 'file:///Users/Shared/';
                }, 100);
            } catch(e) {
                log(`‚ùå Drag & drop failed: ${e.message}`, 'error');
            }
            
            setTimeout(() => document.body.removeChild(dropZone), 3000);
        }

        function testContextMenuBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: Context Menu Bypass`, 'warning');
            
            const element = document.createElement('div');
            element.textContent = 'Right-click here';
            element.style.padding = '15px';
            element.style.background = 'rgba(255,255,0,0.3)';
            element.style.border = '1px solid yellow';
            document.body.appendChild(element);
            
            element.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                log('üéØ Context menu intercepted', 'critical');
                
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = 'file:///System/Library/CoreServices/';
                    link.click();
                }, 100);
            });
            
            setTimeout(() => document.body.removeChild(element), 5000);
        }

        // Method 3: Frame & Window Manipulation
        function testIframeSandboxBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: Iframe Sandbox Bypass`, 'warning');
            
            try {
                const iframe = document.createElement('iframe');
                iframe.sandbox = 'allow-scripts allow-top-navigation';
                iframe.src = 'file:///Users/Shared/';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                setTimeout(() => {
                    try {
                        iframe.contentWindow.location.href = 'file:///Applications/';
                        log('‚úÖ Iframe navigation attempted', 'success');
                    } catch(e) {
                        log(`‚ùå Iframe navigation blocked: ${e.message}`, 'error');
                    }
                    document.body.removeChild(iframe);
                }, 1000);
            } catch(e) {
                log(`‚ùå Iframe creation failed: ${e.message}`, 'error');
            }
        }

        function testWindowOpenBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: window.open Bypass`, 'warning');
            
            try {
                const newWindow = window.open('file:///Users/Shared/', '_blank');
                if (newWindow) {
                    log('‚úÖ window.open succeeded!', 'critical');
                    setTimeout(() => newWindow.close(), 1000);
                } else {
                    log('‚ùå window.open was blocked', 'error');
                }
            } catch(e) {
                log(`‚ùå window.open failed: ${e.message}`, 'error');
            }
        }

        function testLocationReplaceBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: location.replace() Bypass`, 'warning');
            
            try {
                location.replace('file:///Users/Shared/');
                log('‚úÖ location.replace attempted', 'success');
            } catch(e) {
                log(`‚ùå location.replace failed: ${e.message}`, 'error');
            }
        }

        function testPostMessageBypass() {
            testCount++;
            log(`üîÑ Test ${testCount}: PostMessage Bypass`, 'warning');
            
            try {
                const iframe = document.createElement('iframe');
                iframe.src = 'about:blank';
                document.body.appendChild(iframe);
                
                iframe.onload = () => {
                    iframe.contentWindow.postMessage({
                        type: 'navigate',
                        url: 'file:///Users/Shared/'
                    }, '*');
                    log('‚úÖ PostMessage sent to iframe', 'success');
                };
                
                setTimeout(() => document.body.removeChild(iframe), 2000);
            } catch(e) {
                log(`‚ùå PostMessage failed: ${e.message}`, 'error');
            }
        }

        // Method 4: Protocol Handler Tricks
        function testCustomProtocol() {
            testCount++;
            log(`üîÑ Test ${testCount}: Custom Protocol Handler`, 'warning');
            
            try {
                navigator.registerProtocolHandler('file', '/handler.html#%s', 'File Handler');
                log('‚úÖ Custom protocol handler registered', 'success');
            } catch(e) {
                log(`‚ùå Protocol handler registration failed: ${e.message}`, 'error');
            }
            
            try {
                window.location.href = 'x-file-protocol://Users/Shared/';
                log('‚úÖ x-file-protocol attempted', 'success');
            } catch(e) {
                log(`‚ùå x-file-protocol failed: ${e.message}`, 'error');
            }
        }

        function testFileSystemAPI() {
            testCount++;
            log(`üîÑ Test ${testCount}: File System Access API`, 'warning');
            
            if ('showDirectoryPicker' in window) {
                log('‚úÖ File System Access API available', 'success');
            } else {
                log('‚ùå File System Access API not available', 'error');
            }
        }

        function testBlobURLs() {
            testCount++;
            log(`üîÑ Test ${testCount}: Blob URL Redirect`, 'warning');
            
            try {
                const blob = new Blob(['<html><body><script>window.location="file:///Users/Shared/"</script></body></html>'], 
                    {type: 'text/html'});
                const blobUrl = URL.createObjectURL(blob);
                window.open(blobUrl, '_blank');
                log('‚úÖ Blob URL with file:// redirect attempted', 'success');
            } catch(e) {
                log(`‚ùå Blob URL method failed: ${e.message}`, 'error');
            }
        }

        function testDataURIRedirect() {
            testCount++;
            log(`üîÑ Test ${testCount}: Data URI Redirect`, 'warning');
            
            try {
                const dataUri = 'data:text/html,<script>window.location="file:///Users/Shared/"</script>';
                window.open(dataUri, '_blank');
                log('‚úÖ Data URI redirect attempted', 'success');
            } catch(e) {
                log(`‚ùå Data URI method failed: ${e.message}`, 'error');
            }
        }

        // Method 5: Browser-Specific
        function testSafariSpecific() {
            testCount++;
            log(`üîÑ Test ${testCount}: Safari-Specific Methods`, 'warning');
            
            try {
                window.open('file:///Users/Shared/', '_self');
                log('‚úÖ Safari-specific window.open attempted', 'success');
            } catch(e) {
                log(`‚ùå Safari method failed: ${e.message}`, 'error');
            }
        }

        function testChromeSpecific() {
            testCount++;
            log(`üîÑ Test ${testCount}: Chrome-Specific Methods`, 'warning');
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    chrome.runtime.sendMessage({type: 'openFile', url: 'file:///Users/Shared/'});
                    log('‚úÖ Chrome extension API attempted', 'success');
                } else {
                    log('‚ùå Chrome extension API not available', 'error');
                }
            } catch(e) {
                log(`‚ùå Chrome method failed: ${e.message}`, 'error');
            }
        }

        function testFirefoxSpecific() {
            testCount++;
            log(`üîÑ Test ${testCount}: Firefox-Specific Methods`, 'warning');
            
            try {
                window.location.href = 'file:///Users/Shared/';
                log('‚úÖ Firefox location redirect attempted', 'success');
            } catch(e) {
                log(`‚ùå Firefox method failed: ${e.message}`, 'error');
            }
        }

        function runAllTests() {
            log('üöÄ STARTING COMPREHENSIVE BYPASS TEST SUITE', 'critical');
            
            const tests = [
                testUserGestureBypass,
                testDoubleClickBypass,
                testDragAndDropBypass,
                testContextMenuBypass,
                testIframeSandboxBypass,
                testWindowOpenBypass,
                testLocationReplaceBypass,
                testPostMessageBypass,
                testCustomProtocol,
                testFileSystemAPI,
                testBlobURLs,
                testDataURIRedirect,
                testSafariSpecific,
                testChromeSpecific,
                testFirefoxSpecific
            ];
            
            tests.forEach((test, index) => {
                setTimeout(() => test(), index * 2000);
            });
        }

        // Monitor all attempts
        window.addEventListener('error', (e) => {
            if (e.message.includes('local resource')) {
                log(`üõ°Ô∏è SECURITY BLOCKED: ${e.message}`, 'critical');
            }
        });

        log('üîß Advanced file protocol bypass tests initialized', 'info');
        log('üí° These tests attempt various methods to bypass file:// restrictions', 'warning');
        log('‚ö†Ô∏è Most will fail due to browser security policies', 'success');
        log('üéØ Look for any methods that succeed - these would be security findings', 'critical');

    </script>
</body>
</html>
